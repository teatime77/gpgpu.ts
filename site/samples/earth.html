<html>
<head>
<title>Geodesic grid
</title>
<meta http-equiv="content-type" content="text/html; charset=utf-8">
<meta http-equiv="Pragma" content="no-cache">
<meta http-equiv="Cache-Control" content="no-cache">

<script type="text/javascript" src="../lib/glMatrix-0.9.5.min.js"></script>
<script type="module" src="../js/gpgpu.js?ver=1" ></script>
<script type="module" src="../js/shape.js?ver=1" ></script>

<script type="module">
    import {CreateGPGPU, GPGPU, TextureInfo} from "../js/gpgpu.js";
    import {makeEarthBuffers} from "../js/shape.js";

class MyDraw {
    constructor() {
        this.transform = mat4.create();
        mat4.identity(this.transform);

        this.img = new Image();

        this.img.onload = function () {
            var canvas = document.getElementById("webgl-canvas");
            this.MyWebGL = CreateGPGPU(canvas);
            this.MyWebGL.startDraw3D([this]);
        }.bind(this);

        this.img.src = "../img/world.topo.bathy.200408.2048x2048.png";
    }

    getParam() {
        if (!this.package) {

            var [mesh, idx_array] = makeEarthBuffers(new TextureInfo("vec4", null, this.img));

            this.package = {
                id: "Earth",
                vertexShader: GPGPU.textureSphereVertexShader,
                fragmentShader: GPGPU.defaultFragmentShader,
                args: mesh,
                VertexIndexBuffer: idx_array
            };
        }

        return this.package;
    }
}

document.body.onload = function(){
    new MyDraw();
}

</script>
</head>
<body>
    <a href="plane.html">次</a>
    <canvas id="webgl-canvas" style="border: none;" width="500" height="500"></canvas>
</body>
</html>
